<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="../../scripts/raphael.min.js"></script>
    <script src="../../scripts/edo.js"></script>
    <title>Scale Explorer</title>

</head>
<body class="" style="color:white;background-color: black">
<h1>Scale Explorer</h1>
<div id="top">
    <label>Number of Equal Divisions of the Octave (EDO)</label><input id="edo_input" type="text" value="12" size="1"><br>
    <label>Pitch Classes (separated by spaces)</label><input id="scale_input" type="text" value="0 2 4 5 7 9 11"><br>
    <input id="explore_button" type="button" value="Explore Scale">
</div>
<div id="main">
    <div class="row">
        <div class="col">
            <h4>Scale / Common-tone transpositions</h4>
            <div id="transpositions_necklace"></div>
        </div>
        <div class="col">
            <h4>Necklace</h4>
            <div id="necklace"></div>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <h4>Trichords</h4>
            <div id="trichord_necklaces"></div>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <h4>Tetrachords</h4>
            <div id="tetrachord_necklaces"></div>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <h4>Tiercial Stacks of 4</h4>
            <div id="stack_necklaces"></div>
        </div>
    </div>
</div>
<script>
    let update_page = function () {

        let edo = new EDO(parseInt($('#edo_input').val()))
        let scale = edo.scale($('#scale_input').val().split(' ').map((el) => parseInt(el)))
        let transpositions = scale.get.common_tone_transpositions().map((t)=>t[0])
        edo.show.nested_necklaces('transpositions_necklace',transpositions,true,800,false)
        let necklace_paper = edo.make_DOM_svg('necklace',800,800,true).paper
        edo.show.necklace({paper:necklace_paper,pitches:scale.pitches,string_width:3})

        let trichords = scale.get.trichords()
        $("#trichord_necklaces").html("")
        trichords.forEach((trichord,i)=>{
            let trichord_svg = edo.make_DOM_svg('trichord_necklaces',300,300)
            let positions = scale.get.position_of_quality(trichord)
            edo.show.necklace({paper:trichord_svg.paper,pitches:positions,string_width:0,node_radius:10,radius:100,ring:true,inner_strings:false,outer_strings:false,node_color:'red'})
            edo.show.necklace({paper:trichord_svg.paper,pitches:trichord,string_width:3,node_radius:15,radius:70,ring:false})


        })

        let tetrachord = scale.get.n_chords(4)
        $("#tetrachord_necklaces").html("")
        tetrachord.forEach((tetrachord,i)=>{
            let tetrachord_svg = edo.make_DOM_svg('tetrachord_necklaces',300,300)
            let positions = scale.get.position_of_quality(tetrachord)
            edo.show.necklace({paper:tetrachord_svg.paper,pitches:positions,string_width:0,node_radius:10,radius:100,ring:true,inner_strings:false,outer_strings:false,node_color:'red'})
            edo.show.necklace({paper:tetrachord_svg.paper,pitches:tetrachord,string_width:3,node_radius:15,radius:70,ring:false})
        })

        let stacks = scale.get.stacks(4,1)
        $("#stack_necklaces").html("")
        stacks.forEach((stack,i)=>{
            let stack_svg = edo.make_DOM_svg('stack_necklaces',300,300)
            let positions = scale.get.position_of_quality(stack)
            edo.show.necklace({paper:stack_svg.paper,pitches:positions,string_width:0,node_radius:10,radius:100,ring:true,inner_strings:false,outer_strings:false,node_color:'red'})
            edo.show.necklace({paper:stack_svg.paper,pitches:stack,string_width:3,node_radius:15,radius:70,ring:false})


        })





    }
    document.getElementById("explore_button").onclick = function () {
        update_page()
    }
    update_page()

</script>
</body>
</html>